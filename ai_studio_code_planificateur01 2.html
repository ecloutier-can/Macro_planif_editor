<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planification Pharmacie - 165.A0</title>
    <!-- Biblioth√®ques pour export Word EC_Carl-->
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        :root {
            --col-primary: #3D5E6B;    /* Bleu p√©trole */
            --col-secondary: #9CA5B1;  /* Gris bleu */
            --col-accent: #839AD1;     /* Bleu pervenche */
            --col-alert: #F0AF35;      /* Jaune moutarde */
            --col-text: #44474D;       /* Gris anthracite */
            --bg-light: #f4f6f8;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: var(--col-text); background-color: #eef1f5; margin: 0; padding: 20px; font-size: 13px; }
        .container { max-width: 1650px; margin: 0 auto; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 40px; min-height: 100vh; }
       
        <!-- Test Eric-->

        /* EN-T√äTE */
        header { border-bottom: 5px solid var(--col-primary); margin-bottom: 20px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-start; }
        h1 { color: var(--col-primary); margin: 0; text-transform: uppercase; font-size: 24px; letter-spacing: 1px; }
        h2 { color: var(--col-secondary); font-size: 16px; margin-top: 5px; font-weight: 600; margin-bottom: 0; }
        .date-display { color: #444; font-size: 14px; margin-top: 8px; font-weight: bold; font-style: italic; }

        /* INSTRUCTIONS */
        .instructions-box { background-color: #fff9e6; border-left: 5px solid var(--col-alert); padding: 20px; margin-bottom: 30px; border-radius: 4px; display: flex; gap: 20px; align-items: flex-start; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .instructions-icon { font-size: 30px; margin-top: 5px; }
        .instructions-content ul { margin: 5px 0 0 0; padding-left: 20px; }
        .instructions-content li { margin-bottom: 5px; line-height: 1.4; }
        
        /* Bouton Ressource FAD dans les instructions */
        .btn-fad-resource {
            background-color: var(--col-primary);
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: background 0.2s;
            vertical-align: middle;
        }
        .btn-fad-resource:hover { background-color: #2a4049; }

        /* BARRE DE CONTR√îLE */
        .control-bar { position: sticky; top: 0; background: rgba(255,255,255,0.98); padding: 15px 0; border-bottom: 1px solid #ddd; display: flex; gap: 15px; z-index: 100; margin-bottom: 20px; backdrop-filter: blur(5px); }
        .btn { border: none; padding: 10px 20px; border-radius: 4px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-save { background-color: var(--col-primary); color: white; }
        .btn-load { background-color: var(--col-secondary); color: white; }
        .btn-word { background-color: #2b5797; color: white; }
        .btn-print { background-color: var(--col-text); color: white; margin-left: auto; }
        .btn-add { background-color: #f0f0f0; color: var(--col-primary); border: 1px solid #ccc; width: 100%; display: block; padding: 8px; margin-top: 5px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-add:hover { background-color: #e0e0e0; }
        #fileInput { display: none; }

        /* BOUTONS +/- (SPINNER) */
        .spinner-group { display: flex; align-items: center; width: 100%; }
        .spinner-btn { width: 25px; height: 30px; background: #e0e0e0; border: 1px solid #ccc; cursor: pointer; font-weight: bold; color: #555; display: flex; align-items: center; justify-content: center; user-select: none; }
        .spinner-btn:hover { background: #d0d0d0; }
        .spinner-btn.minus { border-radius: 4px 0 0 4px; border-right: none; }
        .spinner-btn.plus { border-radius: 0 4px 4px 0; border-left: none; }
        .spinner-input { width: 50px !important; text-align: center; border-radius: 0 !important; margin: 0; height: 30px; font-weight: bold; }

        /* GRILLES ET INPUTS */
        .info-grid { display: grid; grid-template-columns: 40% 60%; gap: 25px; margin-bottom: 30px; background-color: #fafafa; padding: 25px; border-radius: 8px; border: 1px solid #eee; }
        .info-col-left, .info-col-right { display: flex; flex-direction: column; gap: 15px; }
        .input-group { margin-bottom: 0; }
        label { display: block; font-weight: 800; color: var(--col-primary); margin-bottom: 5px; font-size: 11px; text-transform: uppercase; }
        input[type="text"], textarea, select, input[type="number"], input[type="date"] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #fff; font-family: 'Segoe UI', sans-serif; font-size: 12px; box-sizing: border-box; resize: vertical; }
        select { font-weight: bold; color: #333; background-color: #fcfcfc; }
        #competencyArea { white-space: pre-wrap; font-family: 'Segoe UI', monospace; font-size: 12px; line-height: 1.5; color: #222; }
        
        /* Placeholder styling for better visibility if needed */
        ::placeholder { color: #aab; font-style: italic; opacity: 0.8; }

        /* SEMAINES */
        .week-wrapper { border: 2px solid #ccc; margin-bottom: 30px; break-inside: avoid; background: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.05); border-radius: 4px; overflow: hidden; }
        .week-global-header { background-color: var(--col-primary); color: white; padding: 10px 15px; display: flex; align-items: center; gap: 15px; }
        .week-label { font-size: 18px; font-weight: 800; letter-spacing: 1px; white-space: nowrap; margin-right: 15px; }
        .week-global-input { background: rgba(255,255,255,0.15) !important; border: 1px solid rgba(255,255,255,0.3) !important; color: white !important; font-weight: bold; font-size: 16px !important; flex-grow: 1; }
        .week-global-input::placeholder { color: rgba(255,255,255,0.6); }

        /* S√âQUENCES */
        .session-row { padding: 10px; border-bottom: 3px solid #e0e0e0; }
        .session-header-line { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; background: #f8f9fa; padding: 8px; border-radius: 4px; border: 1px solid #eee; }
        .session-badge { background-color: var(--col-secondary); color: white; font-weight: bold; padding: 4px 12px; border-radius: 15px; font-size: 12px; white-space: nowrap; }
        .grid-columns { display: grid; grid-template-columns: 8% 19% 19% 19% 17% 18%; gap: 8px; }
        .col { padding: 5px; border-right: 1px dashed #eee; }
        .col-header { font-size: 10px; text-transform: uppercase; color: var(--col-text); font-weight: 700; margin-bottom: 5px; border-bottom: 1px solid #eee; text-align: center; }
        .col:not(:first-child) .col-header { text-align: left; }
        
        .checkbox-wrapper { display: flex; align-items: center; font-size: 11px; margin-bottom: 2px; }
        .checkbox-wrapper input { margin-right: 6px; flex-shrink: 0; }
        .mode-selector { display: flex; gap: 2px; margin-bottom: 8px; padding-bottom: 5px; border-bottom: 1px dotted #ddd; }
        .tag-radio { display: none; }
        .tag-label { flex: 1; text-align: center; padding: 2px 0; border-radius: 3px; font-size: 9px; font-weight: bold; border: 1px solid #ccc; cursor: pointer; color: #888; }
        .tag-radio:checked + .tag-label.sync { background-color: var(--col-accent); color: white; }
        .tag-radio:checked + .tag-label.async { background-color: var(--col-alert); color: white; }

        /* √âVALUATIONS */
        .eval-block { border: 1px solid #ccc; margin-bottom: 20px; break-inside: avoid; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .eval-header { background-color: var(--col-text); color: white; padding: 10px 15px; display: flex; align-items: center; gap: 10px; }
        .eval-num { font-weight: 800; font-size: 16px; white-space: nowrap; color: white; }
        .eval-title-input { background: rgba(255,255,255,0.1) !important; color: white !important; font-weight: bold; font-size: 14px !important; border: 1px solid rgba(255,255,255,0.3) !important; flex-grow: 1; }
        .eval-title-input::placeholder { color: rgba(255,255,255,0.6); }

        /* Bouton Aide FAD */
        .btn-help-fad { background: var(--col-alert); color: #222; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; text-decoration: none; border: 1px solid #d99a22; white-space: nowrap; display: inline-flex; align-items: center; gap: 5px; margin-left: 5px; transition: 0.2s; }
        .btn-help-fad:hover { background: #ffbe4f; transform: translateY(-1px); }

        /* Bar de choix en haut (Menus d√©roulants) */
        .eval-top-bar { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; padding: 15px; background: #f4f6f8; border-bottom: 1px solid #ddd; }
        .eval-mini-label { font-size: 10px; font-weight: bold; color: #666; text-transform: uppercase; display: block; margin-bottom: 2px; }
        
        /* Grille principale contenu */
        .eval-main-grid { display: grid; grid-template-columns: 70% 30%; gap: 20px; padding: 20px; }
        
        /* Colonne Description */
        .eval-desc-col { display: flex; flex-direction: column; gap: 15px; }
        
        /* Colonne Droite */
        .eval-side-col { background: #fafafa; padding: 15px; border: 1px solid #eee; border-radius: 4px; }
        .eval-section-title { font-size: 11px; font-weight: 800; color: var(--col-primary); text-transform: uppercase; border-bottom: 2px solid #eee; margin-bottom: 8px; margin-top: 15px; }
        .eval-section-title:first-child { margin-top: 0; }

        h3 { color: var(--col-primary); font-size: 20px; border-bottom: 2px solid var(--col-secondary); padding-bottom: 10px; margin-top: 50px; page-break-before: always; }

        /* EXPORT WORD */
        .word-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-family: Arial, sans-serif; font-size: 11px; }
        .word-table td { border: 1px solid #999; padding: 5px; vertical-align: top; }

        @media print {
            .control-bar, .btn-add, .instructions-box, .btn-help-fad, .btn-fad-resource, .spinner-btn { display: none !important; }
            .container { box-shadow: none; padding: 0; width: 100%; max-width: 100%; }
            textarea, input, select { border: none !important; resize: none; background: transparent !important; padding: 0; }
            select { appearance: none; font-weight: bold; color: black; }
            .week-global-header, .eval-header { -webkit-print-color-adjust: exact; color: white !important; }
            .spinner-input { text-align: left; }
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="instructions-box">
        <div class="instructions-icon">üìù</div>
        <div class="instructions-content">
            <div style="display:flex; align-items:center; flex-wrap:wrap; margin-bottom:5px;">
                <strong>Guide de l'enseignant :</strong>
                <!-- BOUTON RESSOURCE -->
                <a href="https://fadio.net/wp-content/uploads/2022/06/Criteres-de-qualite-dun-cours-en-FAD-1.pdf" target="_blank" class="btn-fad-resource">
                    üìò Crit√®res de qualit√© d'un cours en FAD
                </a>
            </div>
            
            <div style="margin: 8px 0 12px 0; color: #b03a2e; font-weight: bold; background: rgba(255,255,255,0.5); padding: 5px; border-radius: 4px; border-left: 3px solid #b03a2e;">
                ‚ö†Ô∏è RAPPEL IMPORTANT : Pour concevoir votre plan de cours, vous devez imp√©rativement vous r√©f√©rer au Plan-Cadre officiel. Ce document est disponible dans le Teams du programme.
            </div>

            <ul>
                <li><strong>1. D√©marrage :</strong> S√©lectionnez votre <strong>Titre de cours</strong>. Les donn√©es officielles (Devis) se chargeront.</li>
                <li><strong>2. Planification :</strong> Indiquez la <strong>Date</strong> et choisissez l'<strong>√âl√©ment de comp√©tence</strong> pour chaque s√©quence.</li>
                <li><strong>3. Saisie rapide :</strong> Utilisez les boutons <strong>"-" et "+"</strong> pour ajuster le temps (min) et la pond√©ration (%) par tranche de 5.</li>
                <li><strong>4. √âvaluations :</strong> Pr√©cisez la modalit√©, le format, le type et l'√©l√©ment de comp√©tence reli√©.</li>
                <li><strong>5. Sauvegarde & Reprise :</strong> Cliquez sur <strong>"üíæ Sauvegarder (JSON)"</strong> pour enregistrer une copie de travail. Utilisez <strong>"üìÇ Ouvrir"</strong> pour r√©importer ce fichier ult√©rieurement.</li>
                <li><strong>6. Finalisation :</strong> Cliquez sur <strong>"üìÑ Exporter en Word"</strong> pour le document final.</li>
            </ul>
        </div>
    </div>

    <div class="control-bar">
        <button class="btn btn-save" type="button" onclick="saveData()">üíæ Sauvegarder (JSON)</button>
        <button class="btn btn-load" type="button" onclick="document.getElementById('fileInput').click()">üìÇ Ouvrir</button>
        <input type="file" id="fileInput" accept=".json" onchange="loadData(this)">
        <div style="flex-grow:1"></div>
        <button class="btn btn-word" type="button" onclick="exportToWordDocx()">üìÑ Exporter en Word</button>
        <button class="btn btn-print" type="button" onclick="window.print()">üñ®Ô∏è Imprimer</button>
    </div>

    <header>
        <div>
            <h1>Techniques de pharmacie</h1>
            <h2>Planification de cours (15 semaines) - Mode hybride/FAD</h2>
            <div id="currentDateDisplay" class="date-display"></div>
        </div>
        <div style="text-align: right;">
            <div style="background: var(--col-primary); color: white; padding: 5px 15px; font-weight: bold; border-radius: 4px;">165.A0</div>
        </div>
    </header>

    <form id="planningForm">
        <!-- INFO COURS -->
        <section class="info-grid">
            <div class="info-col-left">
                <div class="input-group">
                    <label>Titre du cours</label>
                    <select id="courseSelect" name="courseSelect" onchange="updateCourseInfo()">
                        <option value="">-- S√©lectionnez un cours du programme --</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Nom de l'enseignant(e)</label>
                    <input type="text" name="teacherName" placeholder="Entrez votre nom">
                </div>
                <div class="input-group">
                    <label>Description du cours (Devis Local)</label>
                    <textarea id="descriptionArea" name="descriptionArea" style="height: 160px; background-color: #f9f9f9;" readonly></textarea>
                </div>
                <div class="input-group">
                    <label>Activit√©s d'apprentissage sugg√©r√©es</label>
                    <textarea id="activitiesArea" name="activitiesArea" style="height: 100px; background-color: #f9f9f9;" readonly></textarea>
                </div>
            </div>

            <div class="info-col-right">
                <div class="input-group" style="flex-grow: 1;">
                    <label>Comp√©tences et √âl√©ments cibl√©s</label>
                    <textarea id="competencyArea" name="competencyArea" style="height: 240px; background-color: #f0f4f6; border: 2px solid var(--col-secondary); font-weight: 500;" readonly></textarea>
                </div>
                <div class="input-group">
                    <label>Contexte de r√©alisation de la comp√©tence</label>
                    <textarea id="contextArea" name="contextArea" style="height: 100px; background-color: #fffbeb; border-color: var(--col-alert);" readonly placeholder="S√©lectionnez un cours pour voir le contexte..."></textarea>
                </div>
            </div>
        </section>

        <!-- CONTENEUR SEMAINES -->
        <div id="weeks-container"></div>

        <!-- CONTENEUR √âVALUATIONS -->
        <h3>Planification des √âvaluations</h3>
        <div id="evaluations-container"></div>
        <button type="button" class="btn btn-add" id="btn-add-eval" onclick="addEvaluationRow()">+ Ajouter une √©valuation</button>
    </form>

</div>

<script>
    // VARIABLE POUR LA S√âCURIT√â (Modifications non enregistr√©es)
    let unsavedChanges = false;

    // D√©tecter les changements
    document.getElementById('planningForm').addEventListener('change', function() { unsavedChanges = true; });
    document.getElementById('planningForm').addEventListener('input', function() { unsavedChanges = true; });

    // Avertissement fermeture fen√™tre
    window.addEventListener('beforeunload', function (e) {
        if (unsavedChanges) {
            e.preventDefault();
            // Le message standard du navigateur s'affichera
            e.returnValue = ''; 
        }
    });

    // 1. GESTION DES BOUTONS +/-
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('spinner-btn')) {
            const isPlus = e.target.classList.contains('plus');
            const input = e.target.parentNode.querySelector('input');
            let currentVal = parseInt(input.value) || 0;
            
            if (isPlus) {
                input.value = currentVal + 5;
            } else {
                if (currentVal >= 5) input.value = currentVal - 5;
                else input.value = 0;
            }
            unsavedChanges = true; // Marquer comme modifi√©
        }
    });

    // 2. DATE AUTOMATIQUE
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toLocaleDateString('fr-CA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        const formattedDate = today.charAt(0).toUpperCase() + today.slice(1);
        document.getElementById('currentDateDisplay').textContent = "Date : " + formattedDate;
    });

    // 3. DONN√âES COMPL√àTES (Techniques de pharmacie 165.A0)
    // Donn√©es extraites de la grille de cours et du programme d'√©tudes
    var currentCompetencyElements = [];
    const sessions = {
        "Session 1": {
            "101-275-RA": {
                title: "101-275-RA Biologie appliqu√©e √† la pharmacie I",
                desc: "Ce cours vise √† d√©velopper une vision int√©gr√©e de l'organisme humain et √† caract√©riser les principaux probl√®mes de sant√©. Il constitue la base biologique pour la compr√©hension de l'action des m√©dicaments.",
                context: "‚Ä¢ En soutien aux services pharmaceutiques.\n‚Ä¢ Pour tous les syst√®mes du corps humain.\n‚Ä¢ √Ä partir d'informations m√©dicales et scientifiques.",
                comp: "00Q0: D√©velopper une vision int√©gr√©e de l'organisme humain.\n02AZ: Caract√©riser les principaux probl√®mes de sant√© et les maladies.",
                act: "‚Ä¢ Laboratoires d'anatomie et physiologie.\n‚Ä¢ √âtudes de cas cliniques simples.\n‚Ä¢ Exercices de terminologie m√©dicale.",
                elements: [
                    {text: "1. Se repr√©senter l‚Äôanatomie du corps humain (00Q0).", criteria: "‚Ä¢ Localisation pr√©cise.\n‚Ä¢ Organisation structurale.\n‚Ä¢ Liens structuraux."},
                    {text: "2. Caract√©riser le fonctionnement normal (00Q0).", criteria: "‚Ä¢ Fonctions syst√®mes.\n‚Ä¢ Caract√©ristiques physiologiques.\n‚Ä¢ Liens fonctionnels."},
                    {text: "3. Corps humain et √©quilibre (00Q0).", criteria: "‚Ä¢ Hom√©ostasie.\n‚Ä¢ Facteurs de perturbation."},
                    {text: "1. Corr√©ler probl√®mes sant√©/syst√®mes (02AZ).", criteria: "‚Ä¢ √âtiologie/Physiopathologie.\n‚Ä¢ Facteurs risques.\n‚Ä¢ Manifestations cliniques."},
                    {text: "2. Relier d√©sordres immuno/infectieux (02AZ).", criteria: "‚Ä¢ Type agresseur.\n‚Ä¢ Modes transmission.\n‚Ä¢ Processus √©volutif."},
                    {text: "3. Reconna√Ætre cancers (02AZ).", criteria: "‚Ä¢ Cancers pr√©valents.\n‚Ä¢ Facteurs risque.\n‚Ä¢ Processus physiopathologique."}
                ]
            },
            "412-423-RA": {
                title: "412-423-RA Outils bureautiques et technologiques",
                desc: "Ce cours permet d'exploiter les technologies de l'information (syst√®mes d'information, logiciels bureautiques) et de collaborer au fonctionnement administratif d'une pharmacie.",
                context: "‚Ä¢ √Ä l‚Äôaide de la documentation de r√©f√©rence et des outils technologiques.\n‚Ä¢ √Ä partir des politiques et proc√©dures.",
                comp: "02BP: Exploiter les technologies de l'information et de la t√©l√©communication.\n02BV: Collaborer au fonctionnement administratif d'une pharmacie.",
                act: "‚Ä¢ Ateliers sur logiciels de pharmacie.\n‚Ä¢ Cr√©ation de documents administratifs.\n‚Ä¢ Gestion de dossiers patients informatis√©s.",
                elements: [
                    {text: "1. Distinguer les syst√®mes d‚Äôinformation (02BP).", criteria: "‚Ä¢ Caract√©risation juste.\n‚Ä¢ Distinction √©tablissements/communautaires."},
                    {text: "2. G√©rer un poste de travail informatique (02BP).", criteria: "‚Ä¢ Personnalisation.\n‚Ä¢ Gestion fichiers.\n‚Ä¢ Communication."},
                    {text: "3. Exploiter logiciels bureautique (02BP).", criteria: "‚Ä¢ Bases de donn√©es.\n‚Ä¢ Tableaux/Graphiques.\n‚Ä¢ Pr√©sentations."},
                    {text: "4. Exploiter syst√®mes pharmacie (02BP).", criteria: "‚Ä¢ Fonctionnalit√©s.\n‚Ä¢ Modules applicatifs."},
                    {text: "1. Contribuer gestion ressources (02BV).", criteria: "‚Ä¢ Techniques gestion.\n‚Ä¢ Gestion changement."},
                    {text: "2. Examiner fonctionnement admin (02BV).", criteria: "‚Ä¢ Modalit√©s acquisition.\n‚Ä¢ Programmes acc√®s.\n‚Ä¢ Financement."}
                ]
            },
            "165-384-RA": {
                title: "165-384-RA Introduction aux m√©dicaments et aux ordonnances",
                desc: "Ce cours initie l'√©tudiant aux caract√©ristiques des m√©dicaments (classification, pharmacologie de base) et √† la coordination de leur conditionnement.",
                context: "‚Ä¢ Pour tout type de m√©dicament.\n‚Ä¢ √Ä l‚Äôaide de la documentation de r√©f√©rence.\n‚Ä¢ √Ä partir d'ordonnances.",
                comp: "02BK: Discerner les caract√©ristiques des m√©dicaments.\n02BS: Coordonner le conditionnement des m√©dicaments.",
                act: "‚Ä¢ Exercices de classification des m√©dicaments.\n‚Ä¢ Lecture et analyse d'ordonnances.\n‚Ä¢ Laboratoires de conditionnement.",
                elements: [
                    {text: "1. Cat√©goriser les m√©dicaments (02BK).", criteria: "‚Ä¢ Nomenclature.\n‚Ä¢ Classification.\n‚Ä¢ Formes/Voies.\n‚Ä¢ Termes/Abr√©viations."},
                    {text: "2. Recherche d‚Äôinformation (02BK).", criteria: "‚Ä¢ Sources (primaires/sec/tert).\n‚Ä¢ Donn√©es probantes."},
                    {text: "3. Pharmacocin√©tique (02BK).", criteria: "‚Ä¢ Param√®tres (ADME).\n‚Ä¢ Liens concentration/effet."},
                    {text: "4. M√©canismes d‚Äôaction (02BK).", criteria: "‚Ä¢ Principaux m√©canismes.\n‚Ä¢ Placebo/Nocebo."},
                    {text: "1. Caract√©riser modes conditionnement (02BS).", criteria: "‚Ä¢ Avantages/D√©savantages.\n‚Ä¢ Pr√©cautions sp√©cifiques."},
                    {text: "2. Encadrer activit√©s conditionnement (02BS).", criteria: "‚Ä¢ Ma√Ætrise techniques.\n‚Ä¢ Supervision stricte."}
                ]
            },
            "165-414-RA": {
                title: "165-414-RA Introduction √† la profession",
                desc: "Ce cours analyse la fonction de travail du technicien en pharmacie, le cadre l√©gal, √©thique et organisationnel de la profession.",
                context: "‚Ä¢ En se r√©f√©rant √† l‚Äôorganisation du r√©seau de la sant√©.\n‚Ä¢ √Ä partir des lois, r√®glements et normes.",
                comp: "00HA: Analyser la fonction de travail.",
                act: "‚Ä¢ Recherche documentaire sur la profession.\n‚Ä¢ Rencontres avec des professionnels.\n‚Ä¢ Visites de milieux de travail.",
                elements: [
                    {text: "1. Caract√©riser l‚Äôorganisation des services (00HA).", criteria: "‚Ä¢ Histoire.\n‚Ä¢ R√©seau sant√©.\n‚Ä¢ Distinction milieux."},
                    {text: "2. Caract√©riser la profession (00HA).", criteria: "‚Ä¢ D√©finition.\n‚Ä¢ Conditions acc√®s.\n‚Ä¢ Formation/√âthique."},
                    {text: "3. Caract√©riser circuit m√©dicament (00HA).", criteria: "‚Ä¢ √âtapes.\n‚Ä¢ Organisation physique."},
                    {text: "4. Examiner t√¢ches et habilet√©s (00HA).", criteria: "‚Ä¢ T√¢ches/Op√©rations.\n‚Ä¢ Comportements.\n‚Ä¢ Liens habilet√©s."},
                    {text: "5. Examiner exigences l√©gislatives (00HA).", criteria: "‚Ä¢ Lois/R√®glements.\n‚Ä¢ Normes OPQ.\n‚Ä¢ Limites pratique."},
                    {text: "6. Discerner r√¥les organisations (00HA).", criteria: "‚Ä¢ Instances.\n‚Ä¢ Industrie pharmaceutique."}
                ]
            },
            "165-426-RA": {
                title: "165-426-RA Le devenir du m√©dicament dans l'organisme I",
                desc: "Ce cours approfondit les caract√©ristiques des m√©dicaments et analyse leur usage et leurs effets sur l'organisme humain (Pharmacologie I).",
                context: "‚Ä¢ Pour les m√©dicaments les plus pr√©valents.\n‚Ä¢ √Ä partir des classes pharmacoth√©rapeutiques.",
                comp: "02BK: Discerner les caract√©ristiques des m√©dicaments.\n02BL: Analyser l‚Äôusage des m√©dicaments et leurs effets sur l‚Äôorganisme humain.",
                act: "‚Ä¢ √âtudes de cas pharmacologiques.\n‚Ä¢ Analyse des effets secondaires et interactions.\n‚Ä¢ Recherche sur les classes m√©dicamenteuses.",
                elements: [
                    {text: "3. Distinguer pharmacocin√©tique (02BK).", criteria: "‚Ä¢ Param√®tres.\n‚Ä¢ Concentration/Temps."},
                    {text: "4. Distinguer m√©canismes d‚Äôaction (02BK).", criteria: "‚Ä¢ Types utilisation.\n‚Ä¢ M√©canismes d'action."},
                    {text: "5. Cerner facteurs influen√ßant (02BK).", criteria: "‚Ä¢ Facteurs physio/patho.\n‚Ä¢ Allergies/Intol√©rances.\n‚Ä¢ Interactions."},
                    {text: "1. √âtablir liens m√©dicaments/usages (02BL).", criteria: "‚Ä¢ Conditions sant√©.\n‚Ä¢ Usages classes."},
                    {text: "2. Examiner effets (02BL).", criteria: "‚Ä¢ Posologies.\n‚Ä¢ Effets attendus/ind√©sirables.\n‚Ä¢ Pr√©cautions."}
                ]
            }
        },
        "Session 2": {
            "101-285-RA": {
                title: "101-285-RA Biologie appliqu√©e √† la pharmacie II",
                desc: "Suite de la biologie appliqu√©e, visant √† compl√©ter la vision int√©gr√©e de l'organisme et la caract√©risation des probl√®mes de sant√©.",
                context: "‚Ä¢ En soutien aux services pharmaceutiques.\n‚Ä¢ Pour tous les syst√®mes du corps humain.",
                comp: "00Q0: D√©velopper une vision int√©gr√©e de l'organisme humain.\n02AZ: Caract√©riser les principaux probl√®mes de sant√© et les maladies.",
                act: "‚Ä¢ Laboratoires de physiologie avanc√©e.\n‚Ä¢ √âtudes de pathologies complexes.\n‚Ä¢ Liens anatomie-pathologie.",
                elements: [
                    {text: "1. Se repr√©senter l‚Äôanatomie (00Q0).", criteria: "‚Ä¢ Syst√®mes restants.\n‚Ä¢ Liens structuraux."},
                    {text: "2. Caract√©riser fonctionnement (00Q0).", criteria: "‚Ä¢ Physiologie syst√©mique.\n‚Ä¢ R√©actions biochimiques."},
                    {text: "4. Saisir incidence d√©s√©quilibre (00Q0).", criteria: "‚Ä¢ Modalit√©s apparition.\n‚Ä¢ Processus physiologiques."},
                    {text: "1. Corr√©ler probl√®mes sant√© (02AZ).", criteria: "‚Ä¢ √âtiologie.\n‚Ä¢ Manifestations cliniques.\n‚Ä¢ Processus √©volutif."}
                ]
            },
            "201-294-RA": {
                title: "201-294-RA Math√©matiques en techniques de pharmacie",
                desc: "Ce cours couvre les calculs pharmaceutiques n√©cessaires √† la pratique : conversions, dosages, d√©bits, et statistiques de base.",
                context: "‚Ä¢ √Ä partir d‚Äôordonnances et de rapports.\n‚Ä¢ √Ä l‚Äôaide de la documentation de r√©f√©rence.",
                comp: "02BM: Traiter des donn√©es math√©matiques li√©es aux activit√©s pharmaceutiques.",
                act: "‚Ä¢ Exercices de calculs de doses.\n‚Ä¢ Conversion d'unit√©s.\n‚Ä¢ Calculs de marge b√©n√©ficiaire.",
                elements: [
                    {text: "1. √âtablir conversions (02BM).", criteria: "‚Ä¢ Unit√©s pond√©rales/volum√©triques.\n‚Ä¢ √âquivalences.\n‚Ä¢ Pourcentages."},
                    {text: "2. Effectuer calculs pharmaceutiques (02BM).", criteria: "‚Ä¢ R√®gles proportionnalit√©/dilution/alligation.\n‚Ä¢ Calcul dose/d√©bit."},
                    {text: "3. √âlaborer outils conversion (02BM).", criteria: "‚Ä¢ Pertinence.\n‚Ä¢ Exactitude."},
                    {text: "4. Effectuer calculs administratifs (02BM).", criteria: "‚Ä¢ Prix d√©tail/Marge.\n‚Ä¢ Co√ªt revient.\n‚Ä¢ Ratios personnel."},
                    {text: "5. Interpr√©ter r√©sultats statistiques (02BM).", criteria: "‚Ä¢ Moyenne/M√©diane.\n‚Ä¢ Mesures √©pid√©miologiques."}
                ]
            },
            "350-264-RA": {
                title: "350-264-RA Communication professionnelle en pharmacie",
                desc: "D√©veloppement des comp√©tences communicationnelles en contexte professionnel, pr√©vention des atteintes √† la sant√©/s√©curit√© (aspect psychosocial) et interaction.",
                context: "‚Ä¢ Dans des situations professionnelles vari√©es.\n‚Ä¢ Avec patients, coll√®gues, professionnels.",
                comp: "02BN: Pr√©venir les atteintes √† la sant√©, √† la s√©curit√© et √† l'environnement.\n02BR: Interagir en contexte professionnel.",
                act: "‚Ä¢ Mises en situation et jeux de r√¥les.\n‚Ä¢ Gestion de situations difficiles.\n‚Ä¢ R√©daction professionnelle.",
                elements: [
                    {text: "3. Associer moyens pr√©vention (02BN).", criteria: "‚Ä¢ √âquilibre psycho.\n‚Ä¢ Gestion stress.\n‚Ä¢ Proc√©dures pr√©vention."},
                    {text: "1. Communiquer professionnellement (02BR).", criteria: "‚Ä¢ Verbale/Non-verbale.\n‚Ä¢ √âcoute active.\n‚Ä¢ Approche adapt√©e."},
                    {text: "2. R√©diger documents (02BR).", criteria: "‚Ä¢ Types documents.\n‚Ä¢ Synth√®se.\n‚Ä¢ R√®gles r√©daction."},
                    {text: "3. Travailler en √©quipe (02BR).", criteria: "‚Ä¢ Leadership.\n‚Ä¢ Ouverture.\n‚Ä¢ Prise d√©cision."},
                    {text: "4. Gestion conflits (02BR).", criteria: "‚Ä¢ Concertation.\n‚Ä¢ Solution consensuelle.\n‚Ä¢ Introspection."}
                ]
            },
            "165-234-RA": {
                title: "165-234-RA Le devenir du m√©dicament dans l'organisme II",
                desc: "Suite de l'analyse de l'usage des m√©dicaments (Pharmacologie II). Approfondissement des classes th√©rapeutiques.",
                context: "‚Ä¢ Pour les m√©dicaments sur prescription et en vente libre.\n‚Ä¢ √Ä partir des classes pharmacoth√©rapeutiques.",
                comp: "02BK: Discerner les caract√©ristiques des m√©dicaments.\n02BL: Analyser l‚Äôusage des m√©dicaments et leurs effets sur l‚Äôorganisme humain.",
                act: "‚Ä¢ √âtude des classes pharmacologiques sp√©cifiques.\n‚Ä¢ Analyse de dossiers pharmacologiques.",
                elements: [
                    {text: "1. Cat√©goriser m√©dicaments (02BK).", criteria: "‚Ä¢ Nomenclature.\n‚Ä¢ Classification.\n‚Ä¢ Formes."},
                    {text: "4. Distinguer m√©canismes (02BK).", criteria: "‚Ä¢ M√©canismes action.\n‚Ä¢ Association classes."},
                    {text: "1. √âtablir liens usages (02BL).", criteria: "‚Ä¢ Conditions sant√©.\n‚Ä¢ Usages."},
                    {text: "2. Examiner effets (02BL).", criteria: "‚Ä¢ Posologies.\n‚Ä¢ Effets/Toxicit√©s.\n‚Ä¢ Interactions."},
                    {text: "3. Liens renseignements cliniques (02BL).", criteria: "‚Ä¢ Suivis requis.\n‚Ä¢ Valeurs labo."}
                ]
            },
            "165-394-RA": {
                title: "165-394-RA Introduction aux logiciels en pharmacie",
                desc: "Exploitation approfondie des technologies de l'information : logiciels de gestion de pharmacie (Rx) et √©quipements connect√©s.",
                context: "‚Ä¢ √Ä l‚Äôaide d‚Äôoutils technologiques (syst√®mes pharmacie, logiciels √©quipements).",
                comp: "02BP: Exploiter les technologies de l'information et de la t√©l√©communication.",
                act: "‚Ä¢ Simulation sur logiciels sp√©cialis√©s (ex: RxPro, Ubik).\n‚Ä¢ Gestion de bases de donn√©es m√©dicaments.",
                elements: [
                    {text: "1. Distinguer syst√®mes (02BP).", criteria: "‚Ä¢ Caract√©risation.\n‚Ä¢ Distinction milieux."},
                    {text: "2. G√©rer poste travail (02BP).", criteria: "‚Ä¢ Environnement.\n‚Ä¢ Sites Internet.\n‚Ä¢ Fichiers."},
                    {text: "4. Exploiter syst√®mes pharmacie (02BP).", criteria: "‚Ä¢ Fonctionnalit√©s.\n‚Ä¢ Modules applicatifs.\n‚Ä¢ Utilisation optimale."},
                    {text: "5. Exploiter logiciels √©quipements (02BP).", criteria: "‚Ä¢ Fonctionnalit√©s.\n‚Ä¢ Sant√© connect√©e."},
                    {text: "6. Exploiter logiciels connexes (02BP).", criteria: "‚Ä¢ Outils aide d√©cision."}
                ]
            }
        },
        "Session 3": {
            "165-406-RA": {
                title: "165-406-RA Le devenir du m√©dicament dans l'organisme III",
                desc: "Dernier volet de pharmacologie. Analyse complexe des usages et effets des m√©dicaments.",
                context: "‚Ä¢ Pour les m√©dicaments complexes et situations particuli√®res.",
                comp: "02BK: Discerner les caract√©ristiques des m√©dicaments.\n02BL: Analyser l‚Äôusage des m√©dicaments et leurs effets sur l‚Äôorganisme humain.",
                act: "‚Ä¢ √âtudes de cas complexes.\n‚Ä¢ Analyse de polypharmacie.",
                elements: [
                    {text: "1. Cat√©goriser m√©dicaments (02BK).", criteria: "‚Ä¢ Bio√©quivalence/Biosimilarit√©."},
                    {text: "5. Cerner facteurs influen√ßant (02BK).", criteria: "‚Ä¢ Facteurs physio/patho.\n‚Ä¢ Tol√©rance/D√©pendance."},
                    {text: "1. √âtablir liens usages (02BL).", criteria: "‚Ä¢ Usages classes complexes."},
                    {text: "2. Examiner effets (02BL).", criteria: "‚Ä¢ Effets ind√©sirables graves.\n‚Ä¢ Interactions complexes."},
                    {text: "3. Liens renseignements cliniques (02BL).", criteria: "‚Ä¢ Suivis cliniques.\n‚Ä¢ Param√®tres hors valeurs."}
                ]
            },
            "165-435-RA": {
                title: "165-435-RA Pr√©parations non st√©riles",
                desc: "Ce cours traite de la coordination et de l'ex√©cution des pr√©parations magistrales non st√©riles (cr√®mes, onguents, liquides oraux, etc.).",
                context: "‚Ä¢ Pour la pr√©paration de m√©dicaments dangereux et non dangereux.\n‚Ä¢ Dans des conditions contr√¥l√©es.",
                comp: "02BN: Pr√©venir les atteintes √† la sant√©/s√©curit√©.\n02BT: Coordonner les pr√©parations magistrales non st√©riles.",
                act: "‚Ä¢ Laboratoires de pr√©parations magistrales.\n‚Ä¢ Calculs de formulation.\n‚Ä¢ R√©daction de formules ma√Ætresses.",
                elements: [
                    {text: "4. Pr√©vention contamination (02BN).", criteria: "‚Ä¢ Risques chimiques.\n‚Ä¢ Pr√©cautions manipulation."},
                    {text: "1. Application cadre normatif (02BT).", criteria: "‚Ä¢ Prescriptions.\n‚Ä¢ Cat√©gorisation pr√©parations."},
                    {text: "2. R√©diger formules ma√Ætresses (02BT).", criteria: "‚Ä¢ Compatibilit√©.\n‚Ä¢ Calculs.\n‚Ä¢ √âtapes critiques."},
                    {text: "3. Encadrer activit√©s (02BT).", criteria: "‚Ä¢ Techniques.\n‚Ä¢ Supervision.\n‚Ä¢ Cons√©quences erreurs."},
                    {text: "4. Veiller conformit√© (02BT).", criteria: "‚Ä¢ Double v√©rification.\n‚Ä¢ √âtiquetage.\n‚Ä¢ Entreposage."}
                ]
            },
            "165-446-RA": {
                title: "165-446-RA Conditionnement des m√©dicaments I",
                desc: "Coordination du conditionnement des m√©dicaments, utilisation des √©quipements (automates) et gestion des op√©rations associ√©es.",
                context: "‚Ä¢ Pour les services pharmaceutiques.\n‚Ä¢ √Ä l‚Äôaide des √©quipements et appareils.",
                comp: "02BQ: Exploiter des √©quipements et des appareils.\n02BS: Coordonner le conditionnement des m√©dicaments.",
                act: "‚Ä¢ Utilisation d'automates de conditionnement.\n‚Ä¢ Proc√©dures de r√©-emballage.",
                elements: [
                    {text: "3. Exploiter √©quipements (02BQ).", criteria: "‚Ä¢ Utilisation.\n‚Ä¢ Entretien.\n‚Ä¢ √âtalonnage."},
                    {text: "1. Caract√©riser modes (02BS).", criteria: "‚Ä¢ Avantages/D√©savantages.\n‚Ä¢ Concordance."},
                    {text: "2. Encadrer activit√©s (02BS).", criteria: "‚Ä¢ Techniques manipulation.\n‚Ä¢ Supervision proc√©dures."},
                    {text: "3. Veiller conformit√© (02BS).", criteria: "‚Ä¢ √âtiquetage.\n‚Ä¢ Dates limites.\n‚Ä¢ Tra√ßabilit√©."},
                    {text: "5. Veiller consignation (02BS).", criteria: "‚Ä¢ Registres.\n‚Ä¢ Archivage."}
                ]
            }
        },
        "Session 4": {
            "410-4L3-RA": {
                title: "410-4L3-RA Pratiques de gestion en pharmacie",
                desc: "Ce cours aborde les aspects administratifs : calculs financiers, gestion des op√©rations, approvisionnement et contr√¥le des activit√©s.",
                context: "‚Ä¢ En collaboration avec le personnel administratif et technique.",
                comp: "02BM: Traiter des donn√©es math√©matiques.\n02BV: Collaborer au fonctionnement administratif.\n02BY: Contr√¥ler les op√©rations de la chaine d'approvisionnement.",
                act: "‚Ä¢ Calculs de prix et marges.\n‚Ä¢ Gestion des stocks.\n‚Ä¢ Simulation de gestion administrative.",
                elements: [
                    {text: "4. Calculs administratifs (02BM).", criteria: "‚Ä¢ Prix/Marge.\n‚Ä¢ Co√ªt revient."},
                    {text: "2. Examiner fonctionnement (02BV).", criteria: "‚Ä¢ Modalit√©s acquisition.\n‚Ä¢ Financement/D√©penses."},
                    {text: "3. Soutenir facturation (02BV).", criteria: "‚Ä¢ Assurances.\n‚Ä¢ Actes pharmaceutiques.\n‚Ä¢ Conciliation."},
                    {text: "1. Caract√©riser stocks (02BY).", criteria: "‚Ä¢ Param√®tres cha√Æne.\n‚Ä¢ Lieux entreposage."},
                    {text: "2. Contr√¥ler approvisionnement (02BY).", criteria: "‚Ä¢ Bases donn√©es.\n‚Ä¢ Rapports consommation.\n‚Ä¢ R√®gles budg√©taires."}
                ]
            },
            "180-454-RA": {
                title: "180-454-RA Probl√®mes de sant√© et maladies",
                desc: "Approfondissement des pathologies et pr√©vention des atteintes √† la sant√©.",
                context: "‚Ä¢ Pour les maladies pr√©valentes.\n‚Ä¢ √Ä partir d'informations cliniques.",
                comp: "02AZ: Caract√©riser les principaux probl√®mes de sant√©.\n02BN: Pr√©venir les atteintes √† la sant√© et s√©curit√©.",
                act: "‚Ä¢ √âtude de physiopathologie.\n‚Ä¢ Mesures de pr√©vention et contr√¥le des infections.",
                elements: [
                    {text: "1. Corr√©ler probl√®mes sant√© (02AZ).", criteria: "‚Ä¢ √âtiologie.\n‚Ä¢ Facteurs risques.\n‚Ä¢ Processus √©volutif."},
                    {text: "4. Pr√©vention infections (02BN).", criteria: "‚Ä¢ Processus infectieux.\n‚Ä¢ Pratiques asepsie.\n‚Ä¢ Entretien aires."}
                ]
            },
            "165-304-RA": {
                title: "165-304-RA Contr√¥le de la cha√Æne d'approvisionnement",
                desc: "Gestion compl√®te de la cha√Æne d'approvisionnement : r√©ception, entreposage, inventaire, retours et destruction.",
                context: "‚Ä¢ Pour tous les m√©dicaments et fournitures.",
                comp: "02BY: Contr√¥ler les op√©rations de la chaine d'approvisionnement.",
                act: "‚Ä¢ Simulation de r√©ception et gestion des √©carts.\n‚Ä¢ Inventaires.\n‚Ä¢ Gestion des p√©rim√©s.",
                elements: [
                    {text: "3. Contr√¥ler r√©ception (02BY).", criteria: "‚Ä¢ Proc√©dures.\n‚Ä¢ Suivi √©carts."},
                    {text: "4. Contr√¥ler entreposage (02BY).", criteria: "‚Ä¢ Cha√Æne de froid.\n‚Ä¢ S√©curit√©.\n‚Ä¢ Tra√ßabilit√©."},
                    {text: "5. Contr√¥ler stocks (02BY).", criteria: "‚Ä¢ Inventaires.\n‚Ä¢ Analyse √©carts."},
                    {text: "6. Retours et rappels (02BY).", criteria: "‚Ä¢ Fournisseurs.\n‚Ä¢ Gestion rappels."},
                    {text: "7. Contr√¥ler destruction (02BY).", criteria: "‚Ä¢ D√©chets biom√©dicaux.\n‚Ä¢ Proc√©dures."}
                ]
            },
            "165-456-RA": {
                title: "165-456-RA Conditionnement des m√©dicaments II",
                desc: "Perfectionnement en conditionnement, utilisation avanc√©e des technologies et coordination.",
                context: "‚Ä¢ √Ä l‚Äôaide d‚Äô√©quipements et de technologies.",
                comp: "02BP: Exploiter technologies info.\n02BQ: Exploiter √©quipements.\n02BS: Coordonner le conditionnement.",
                act: "‚Ä¢ Conditionnement complexe.\n‚Ä¢ Gestion des automates.",
                elements: [
                    {text: "5. Logiciels √©quipements (02BP).", criteria: "‚Ä¢ Fonctionnalit√©s.\n‚Ä¢ Modules applicatifs."},
                    {text: "3. Exploiter √©quipements (02BQ).", criteria: "‚Ä¢ Entretien/√âtalonnage.\n‚Ä¢ Registres."},
                    {text: "3. Veiller conformit√© (02BS).", criteria: "‚Ä¢ Concordance.\n‚Ä¢ Rectification anomalies."},
                    {text: "5. Veiller consignation (02BS).", criteria: "‚Ä¢ Tra√ßabilit√©.\n‚Ä¢ Archivage."}
                ]
            },
            "165-467-RA": {
                title: "165-467-RA Pr√©paration de produits st√©riles",
                desc: "Coordination et ex√©cution des pr√©parations st√©riles dangereuses et non dangereuses.",
                context: "‚Ä¢ Dans des conditions contr√¥l√©es (salles blanches, hottes).",
                comp: "02BU: Coordonner la pr√©paration de produits st√©riles.",
                act: "‚Ä¢ Techniques aseptiques avanc√©es.\n‚Ä¢ Pr√©parations oncologiques.\n‚Ä¢ Contr√¥les environnementaux.",
                elements: [
                    {text: "1. Application cadre normatif (02BU).", criteria: "‚Ä¢ Produits dangereux/non.\n‚Ä¢ Niveaux risque."},
                    {text: "2. R√©diger protocoles (02BU).", criteria: "‚Ä¢ Compatibilit√©.\n‚Ä¢ Calculs.\n‚Ä¢ V√©rification."},
                    {text: "3. Encadrer activit√©s (02BU).", criteria: "‚Ä¢ Techniques.\n‚Ä¢ Supervision."},
                    {text: "4. Veiller conformit√© (02BU).", criteria: "‚Ä¢ Double v√©rification.\n‚Ä¢ √âtiquetage.\n‚Ä¢ Entreposage."},
                    {text: "6. Veiller consignation (02BU).", criteria: "‚Ä¢ Registres.\n‚Ä¢ Tra√ßabilit√©."}
                ]
            },
            "165-47S-RA": {
                title: "165-47S-RA Stage I",
                desc: "Premier stage d'int√©gration en milieu professionnel (communautaire ou hospitalier).",
                context: "‚Ä¢ En milieu r√©el.\n‚Ä¢ Sous supervision.",
                comp: "02BN: Pr√©venir atteintes sant√©.\n02BR: Interagir.\n02BZ: Contr√¥ler activit√©s circuit.\n02C9: G√©rer technologies.",
                act: "‚Ä¢ Int√©gration √† l'√©quipe.\n‚Ä¢ Ex√©cution t√¢ches techniques.\n‚Ä¢ Service client.",
                elements: [
                    {text: "Adopter attitudes professionnelles (02BR).", criteria: "‚Ä¢ Respect.\n‚Ä¢ Communication.\n‚Ä¢ √âthique."},
                    {text: "Appliquer mesures s√©curit√© (02BN).", criteria: "‚Ä¢ Pr√©vention.\n‚Ä¢ Hygi√®ne."},
                    {text: "Coordonner activit√©s (02BZ).", criteria: "‚Ä¢ Priorit√©s.\n‚Ä¢ Flux de travail."},
                    {text: "Utiliser technologies (02C9).", criteria: "‚Ä¢ Logiciels.\n‚Ä¢ √âquipements."}
                ]
            }
        },
        "Session 5": {
            "410-4M4-RA": {
                title: "410-4M4-RA Gestion du personnel en pharmacie",
                desc: "Gestion des ressources humaines techniques : embauche, formation, √©valuation, horaires.",
                context: "‚Ä¢ En collaboration avec le pharmacien.",
                comp: "02BV: Collaborer fonctionnement admin.\n02BX: G√©rer le personnel technique.",
                act: "‚Ä¢ Simulation gestion RH.\n‚Ä¢ Planification horaires.\n‚Ä¢ √âvaluation rendement.",
                elements: [
                    {text: "1. Gestion ressources (02BV).", criteria: "‚Ä¢ Techniques gestion.\n‚Ä¢ Gestion changement."},
                    {text: "1. Processus embauche (02BX).", criteria: "‚Ä¢ Besoins.\n‚Ä¢ Entrevues."},
                    {text: "2. Accueil/Orientation (02BX).", criteria: "‚Ä¢ Programme orientation.\n‚Ä¢ Int√©gration."},
                    {text: "4. Gestion horaires (02BX).", criteria: "‚Ä¢ Disponibilit√©s.\n‚Ä¢ Besoins op√©rationnels."},
                    {text: "5. Appr√©cier rendement (02BX).", criteria: "‚Ä¢ Indicateurs.\n‚Ä¢ R√©troaction."},
                    {text: "7. Coordonner formation (02BX).", criteria: "‚Ä¢ Besoins formation.\n‚Ä¢ Planification."}
                ]
            },
            "180-464-RA": {
                title: "180-464-RA RCR, administration de m√©dicaments et pr√©l√®vements",
                desc: "Comp√©tences cliniques techniques : RCR, administration de m√©dicaments, pr√©l√®vements.",
                context: "‚Ä¢ Situations d'urgence.\n‚Ä¢ Soins aux patients.",
                comp: "02BN: Pr√©venir atteintes sant√©.\n02CA: Collaborer prise en charge th√©rapie.",
                act: "‚Ä¢ Formation RCR.\n‚Ä¢ Techniques d'injection/pr√©l√®vement.\n‚Ä¢ Mesures d'urgence.",
                elements: [
                    {text: "6. Appliquer mesures urgence (02BN).", criteria: "‚Ä¢ Protocoles urgence.\n‚Ä¢ Premiers soins."},
                    {text: "7. Techniques administration (02CA).", criteria: "‚Ä¢ Voies administration.\n‚Ä¢ Asepsie.\n‚Ä¢ Consignation."},
                    {text: "8. Techniques pr√©l√®vement (02CA).", criteria: "‚Ä¢ Pr√©cautions.\n‚Ä¢ Techniques.\n‚Ä¢ Conservation."}
                ]
            },
            "165-325-RA": {
                title: "165-325-RA Fonctionnement administratif d'une pharmacie",
                desc: "Approfondissement de la gestion administrative : facturation, gestion documentaire, rayonnement.",
                context: "‚Ä¢ En pharmacie communautaire et √©tablissement.",
                comp: "02BV: Collaborer au fonctionnement administratif.\n02BX: G√©rer personnel (partiel).",
                act: "‚Ä¢ Gestion complexe facturation.\n‚Ä¢ Gestion documentaire.\n‚Ä¢ Activit√©s promotionnelles.",
                elements: [
                    {text: "3. Soutenir facturation (02BV).", criteria: "‚Ä¢ Programmes assurance.\n‚Ä¢ R√©clamations complexes."},
                    {text: "4. Gestion documentaire (02BV).", criteria: "‚Ä¢ Classement/Archivage.\n‚Ä¢ √âpuration."},
                    {text: "5. Participer rayonnement (02BV).", criteria: "‚Ä¢ Promotion sant√©.\n‚Ä¢ Partenariats."},
                    {text: "3. Structurer organisation travail (02BX).", criteria: "‚Ä¢ Processus travail.\n‚Ä¢ T√¢ches."}
                ]
            },
            "165-336-RA": {
                title: "165-336-RA Contr√¥le du circuit du m√©dicament",
                desc: "Contr√¥le global des activit√©s techniques : traitement ordonnances, distribution, qualit√©, technologies.",
                context: "‚Ä¢ Pour l'ensemble du circuit du m√©dicament.",
                comp: "02BZ: Contr√¥ler des activit√©s li√©es au circuit du m√©dicament.\n02C9: G√©rer les technologies li√©es au circuit.",
                act: "‚Ä¢ Supervision flux de travail.\n‚Ä¢ Contr√¥le qualit√© ordonnances.\n‚Ä¢ Gestion pannes technologiques.",
                elements: [
                    {text: "1. Coordonner activit√©s (02BZ).", criteria: "‚Ä¢ Priorit√©s.\n‚Ä¢ Goulots.\n‚Ä¢ Ajustements."},
                    {text: "2. Assurer traitement ordonnances (02BZ).", criteria: "‚Ä¢ D√©lais.\n‚Ä¢ Validation.\n‚Ä¢ R√©solution probl√®mes."},
                    {text: "3. Assurer distribution (02BZ).", criteria: "‚Ä¢ Moyens technologiques.\n‚Ä¢ Rapports.\n‚Ä¢ Fluctuations."},
                    {text: "1. Optimiser syst√®mes (02C9).", criteria: "‚Ä¢ Interfaces.\n‚Ä¢ Mises √† jour."},
                    {text: "3. Pallier dysfonctionnements (02C9).", criteria: "‚Ä¢ Appels service.\n‚Ä¢ Plan contingence."}
                ]
            },
            "165-486-RA": {
                title: "165-486-RA Prise en charge de la th√©rapie m√©dicamenteuse",
                desc: "Collaboration clinique : collecte de donn√©es, bilan comparatif, enseignement technique aux patients.",
                context: "‚Ä¢ En collaboration avec l'√©quipe de soins.",
                comp: "02CA: Collaborer √† la prise en charge de la th√©rapie m√©dicamenteuse.",
                act: "‚Ä¢ Entrevues patients.\n‚Ä¢ Bilan comparatif.\n‚Ä¢ Enseignement dispositifs.",
                elements: [
                    {text: "1. Contribuer collecte renseignements (02CA).", criteria: "‚Ä¢ Entrevue.\n‚Ä¢ Bilan comparatif.\n‚Ä¢ Consignation."},
                    {text: "2. Colliger valeurs (02CA).", criteria: "‚Ä¢ S√©lection.\n‚Ä¢ Corr√©lation.\n‚Ä¢ R√©sultats hors normes."},
                    {text: "3. Participer plan prise en charge (02CA).", criteria: "‚Ä¢ Mesures cliniques.\n‚Ä¢ D√©tection probl√®mes.\n‚Ä¢ Transmission info."},
                    {text: "6. Enseigner utilisation appareils (02CA).", criteria: "‚Ä¢ D√©monstration.\n‚Ä¢ Asepsie.\n‚Ä¢ √âvaluation compr√©hension."}
                ]
            }
        },
        "Session 6": {
            "165-353-RA": {
                title: "165-353-RA √âtudes cliniques",
                desc: "Gestion des aspects techniques de la recherche clinique : protocoles, m√©dicaments de recherche.",
                context: "‚Ä¢ Pour des m√©dicaments de recherche.",
                comp: "02CB: Collaborer √† des √©tudes cliniques.",
                act: "‚Ä¢ Analyse protocoles.\n‚Ä¢ Gestion inventaire recherche.\n‚Ä¢ Audits.",
                elements: [
                    {text: "1. Reconna√Ætre concepts (02CB).", criteria: "‚Ä¢ Phases cliniques.\n‚Ä¢ Devis.\n‚Ä¢ √âthique."},
                    {text: "2. Traiter aspects techniques (02CB).", criteria: "‚Ä¢ Synth√®se protocole.\n‚Ä¢ Anticipation probl√®mes.\n‚Ä¢ Proc√©dures."},
                    {text: "3. Contr√¥ler approvisionnement (02CB).", criteria: "‚Ä¢ Stocks.\n‚Ä¢ Conservation.\n‚Ä¢ Rapports."},
                    {text: "4. Appliquer protocole (02CB).", criteria: "‚Ä¢ Crit√®res inclusion.\n‚Ä¢ Consentement.\n‚Ä¢ Documentation."},
                    {text: "5. Veiller conformit√© doc (02CB).", criteria: "‚Ä¢ Registres.\n‚Ä¢ Audits.\n‚Ä¢ Fermeture √©tudes."}
                ]
            },
            "165-36S-RA": {
                title: "165-36S-RA Stage II et pr√©paration √† la certification",
                desc: "Stage final d'int√©gration et consolidation des comp√©tences pour la pratique autonome.",
                context: "‚Ä¢ En milieu de travail.\n‚Ä¢ Pr√©paration √† l'examen de l'ordre/certification.",
                comp: "Int√©gration de l'ensemble des comp√©tences sp√©cifiques (02BU, 02BX, 02BY, 02BZ, 02C9, 02CA).",
                act: "‚Ä¢ Pratique autonome.\n‚Ä¢ Gestion compl√®te de t√¢ches.\n‚Ä¢ R√©solution de probl√®mes complexes.",
                elements: [
                    {text: "Int√©gration pratique.", criteria: "‚Ä¢ Autonomie.\n‚Ä¢ Qualit√© travail.\n‚Ä¢ Vitesse ex√©cution."},
                    {text: "Gestion compl√®te circuit.", criteria: "‚Ä¢ De l'ordonnance √† la remise.\n‚Ä¢ V√©rification."},
                    {text: "Attitudes professionnelles.", criteria: "‚Ä¢ √âthique.\n‚Ä¢ Collaboration.\n‚Ä¢ Responsabilit√©."}
                ]
            },
            "165-493-RA": {
                title: "165-493-RA Contr√¥le de la qualit√© et am√©lioration continue",
                desc: "Mise en ≈ìuvre de programmes de qualit√©, gestion des risques et am√©lioration des processus.",
                context: "‚Ä¢ Pour les processus du circuit du m√©dicament.",
                comp: "02BW: Collaborer au contr√¥le de la qualit√© et √† l'am√©lioration continue.",
                act: "‚Ä¢ Analyse d'incidents.\n‚Ä¢ Audits de qualit√©.\n‚Ä¢ R√©daction de proc√©dures.",
                elements: [
                    {text: "1. Moyens contr√¥le qualit√© (02BW).", criteria: "‚Ä¢ Principes QA/QC.\n‚Ä¢ √âtapes critiques.\n‚Ä¢ Registres tra√ßabilit√©."},
                    {text: "2. Gestion des risques (02BW).", criteria: "‚Ä¢ Facteurs risque.\n‚Ä¢ Rapports √©v√©nements.\n‚Ä¢ Mesures correctives."},
                    {text: "3. Am√©lioration continue (02BW).", criteria: "‚Ä¢ M√©thodes.\n‚Ä¢ Suivi solutions.\n‚Ä¢ Comit√©s."},
                    {text: "4. Activit√©s accr√©ditation (02BW).", criteria: "‚Ä¢ Organismes.\n‚Ä¢ Inspection.\n‚Ä¢ Plans am√©lioration."},
                    {text: "5. Mesurer performance (02BW).", criteria: "‚Ä¢ Indicateurs.\n‚Ä¢ Audits."},
                    {text: "6. Actualiser proc√©dures (02BW).", criteria: "‚Ä¢ R√©daction.\n‚Ä¢ R√©vision.\n‚Ä¢ Diffusion."}
                ]
            }
        }
    };

    // 4. INITIALISATION
    const selectElement = document.getElementById('courseSelect');
    for (const [sessionName, courses] of Object.entries(sessions)) {
        const group = document.createElement('optgroup');
        group.label = sessionName;
        for (const [code, data] of Object.entries(courses)) {
            const option = document.createElement('option');
            option.value = code;
            option.textContent = data.title;
            group.appendChild(option);
        }
        selectElement.appendChild(group);
    }

    function updateCourseInfo() {
        const code = document.getElementById('courseSelect').value;
        let foundData = null;
        for (const session in sessions) {
            if (sessions[session][code]) { foundData = sessions[session][code]; break; }
        }

        if (foundData) {
            document.getElementById('descriptionArea').value = foundData.desc;
            document.getElementById('contextArea').value = foundData.context || "Contexte non sp√©cifi√©.";
            document.getElementById('competencyArea').value = foundData.comp;
            document.getElementById('activitiesArea').value = foundData.act;
            currentCompetencyElements = foundData.elements || [];
        } else {
            document.getElementById('descriptionArea').value = "";
            document.getElementById('contextArea').value = "";
            document.getElementById('competencyArea').value = "";
            document.getElementById('activitiesArea').value = "";
            currentCompetencyElements = [];
        }
        updateAllCompetencySelects();
    }

    function updateAllCompetencySelects() {
        const selects = document.querySelectorAll('.competency-select');
        selects.forEach(sel => {
            const currentVal = sel.value; 
            sel.innerHTML = '<option value="">-- Choisir √âl√©ment Comp√©tence --</option>';
            currentCompetencyElements.forEach(elem => {
                const opt = document.createElement('option');
                opt.value = elem.text; 
                opt.textContent = "‚îî‚îÄ " + (elem.text.length > 80 ? elem.text.substring(0, 80) + '...' : elem.text);
                opt.title = elem.criteria; 
                sel.appendChild(opt);
            });
            if(currentCompetencyElements.some(e => e.text === currentVal)) sel.value = currentVal;
        });
    }

    // 5. GENERATION SEMAINES
    const weeksContainer = document.getElementById('weeks-container');
    const tools = [{id: 'zoom', l: 'Zoom/Teams'}, {id: 'moodle', l: 'Moodle'}, {id: 'padlet', l: 'Padlet'}, {id: 'wooclap', l: 'Wooclap'}, {id: 'office', l: 'Office365'}, {id: 'autre', l: 'Autre'}];

    function createSessionHTML(w, s) {
        let toolsHtml = tools.map(t => 
            `<label class="checkbox-wrapper">
                <input type="checkbox" name="w${w}${s}_t_${t.id}"> ${t.l} 
                ${t.id==='autre'?'<input type="text" name="w'+w+s+'_t_other" placeholder="...">':''}
            </label>`
        ).join('');

        // SUGGESTIONS DE CONTENU (PLACEHOLDERS)
        const ph_cont = "‚Ä¢ Th√©orie, lois et r√®glements √† enseigner...";
        const ph_prep = "‚Ä¢ PowerPoint\n‚Ä¢ Feuille de notes\n‚Ä¢ Fiches d'activit√©...";
        const ph_stud = "‚Ä¢ Lire le texte\n‚Ä¢ Travail en √©quipe\n‚Ä¢ Compl√©ter le Padlet...";
        const ph_build = "‚Ä¢ Cr√©ation d'un Wooclap\n‚Ä¢ Vid√©o asynchrone\n‚Ä¢ Questionnaire...";

        return `
            <div class="session-row">
                <div class="session-header-line">
                    <span class="session-badge">S√©quence ${s}</span>
                    <input type="date" name="w${w}${s}_date">
                    <select name="w${w}${s}_comp" class="competency-select" style="flex-grow:1;"><option value="">-- Choisir --</option></select>
                </div>
                <div class="grid-columns">
                    <div class="col" style="text-align:center;">
                        <div class="col-header">Dur√©e</div>
                        <div class="spinner-group">
                            <div class="spinner-btn minus">-</div>
                            <input type="number" name="w${w}${s}_dur" class="spinner-input" value="0" min="0" step="5">
                            <div class="spinner-btn plus">+</div>
                        </div>
                        <span style="font-size:10px; font-weight:bold; color:#888;">min</span>
                    </div>
                    
                    <!-- CONTENU -->
                    <div class="col">
                        <div class="col-header">Contenu</div>
                        <textarea name="w${w}${s}_cont" style="height:80px;" placeholder="${ph_cont}"></textarea>
                    </div>
                    
                    <!-- PR√âPA PROF -->
                    <div class="col" style="background:#fcfcfc;">
                        <div class="col-header">Pr√©pa Prof</div>
                        <textarea name="w${w}${s}_prep" style="height:80px;" placeholder="${ph_prep}"></textarea>
                    </div>
                    
                    <!-- T√ÇCHE √âTUDIANT -->
                    <div class="col">
                        <div class="col-header">T√¢che √âtudiant</div>
                        <textarea name="w${w}${s}_stud" style="height:80px;" placeholder="${ph_stud}"></textarea>
                    </div>
                    
                    <div class="col">
                        <div class="col-header">Mode & Outils</div>
                        <div class="mode-selector">
                            <input type="radio" name="w${w}${s}_mode" value="sync" id="s${w}${s}" class="tag-radio">
                            <label for="s${w}${s}" class="tag-label sync">SY</label>
                            <input type="radio" name="w${w}${s}_mode" value="async" id="a${w}${s}" class="tag-radio">
                            <label for="a${w}${s}" class="tag-label async">AS</label>
                        </div>
                        <div style="display:flex; flex-direction:column;">${toolsHtml}</div>
                    </div>
                    
                    <!-- √Ä CONSTRUIRE -->
                    <div class="col" style="background:#fffbeb;">
                        <div class="col-header">√Ä construire (FAD)</div>
                        <textarea name="w${w}${s}_build" style="height:80px;" placeholder="${ph_build}"></textarea>
                    </div>
                </div>
            </div>`;
    }

    function addSessionRow(w) {
        let c = document.getElementById(`wc-${w}`);
        let l = String.fromCharCode(65 + c.children.length);
        let d = document.createElement('div');
        d.innerHTML = createSessionHTML(w, l);
        c.appendChild(d.firstElementChild);
        updateAllCompetencySelects();
    }

    for(let i=1; i<=15; i++) {
        weeksContainer.innerHTML += `
            <div class="week-wrapper">
                <div class="week-global-header"><span class="week-label">SEMAINE ${i}</span><input type="text" name="w${i}_title" class="week-global-input" placeholder="TH√àME..."></div>
                <div id="wc-${i}">${createSessionHTML(i, 'A')}</div>
                <button type="button" class="btn-add" onclick="addSessionRow(${i})">+ Ajouter une s√©quence</button>
            </div>`;
    }

    // 6. GENERATION EVALUATIONS (AVEC BOUTONS +/- ET LIEN FAD)
    const evalContainer = document.getElementById('evaluations-container');

    function createEvalHTML(i) {
        return `
        <div class="eval-block">
            <div class="eval-header">
                <div style="display:flex; align-items:center; flex-grow:1; gap:10px;">
                    <span class="eval-num">√âVALUATION ${i}</span>
                    <input type="text" name="ev${i}_title" class="eval-title-input" placeholder="Titre...">
                    <a href="https://fadio.net/wp-content/uploads/2023/02/Recto-verso_Evaluation_en_FAD_VF-1.pdf" target="_blank" class="btn-help-fad" title="Guide: Valider la qualit√© d'une √©valuation en FAD">
                        <span>üí° Aide FAD</span>
                    </a>
                </div>
                <div style="display:flex; align-items:center; gap:5px;">
                    <label style="color:white; margin:0;">Date:</label>
                    <input type="date" name="ev${i}_date" style="width:130px;">
                </div>
            </div>
            
            <div class="eval-top-bar">
                <div><span class="eval-mini-label">Type</span>
                    <select name="ev${i}_type" style="width:100%"><option value="">- Choisir -</option><option>Diagnostique</option><option>Formative</option><option>Sommative</option><option>Certificative</option></select>
                </div>
                <div><span class="eval-mini-label">Format</span>
                    <select name="ev${i}_fmt" style="width:100%"><option value="">- Choisir -</option><option>Examen √©crit</option><option>Examen pratique</option><option>Travail long</option><option>Pr√©sentation orale</option><option>Portfolio</option><option>Projet</option><option>√âtude de cas</option><option>Laboratoire</option><option>Stage</option><option>Entrevue</option><option>Autre</option></select>
                </div>
                <div><span class="eval-mini-label">Modalit√©</span>
                    <select name="ev${i}_mod" style="width:100%"><option>Individuel</option><option>√âquipe</option></select>
                </div>
                <div><span class="eval-mini-label">Bloom</span>
                    <select name="ev${i}_bloom" style="width:100%"><option value="">- Choisir -</option><option>Connaissances</option><option>Application</option><option>Analyse</option><option>Synth√®se</option><option>√âvaluation</option><option>Cr√©ativit√©</option></select>
                </div>
            </div>

            <div class="eval-main-grid">
                <div class="eval-desc-col">
                    <div style="background:#f0f4f6; padding:10px; border:1px solid #ddd;">
                        <label>Comp√©tence Cibl√©e</label>
                        <select name="ev${i}_comp" class="competency-select" style="width:100%"><option value="">-- Choisir --</option></select>
                    </div>
                    <div>
                        <label>Description D√©taill√©e de la T√¢che</label>
                        <textarea name="ev${i}_desc" style="width:100%; height:300px; padding:10px; background:#fcfcfc;" placeholder="Contexte, consignes..."></textarea>
                    </div>
                </div>

                <div class="eval-side-col">
                    <div class="eval-section-title">Logistique</div>
                    <div style="margin-bottom:15px;">
                        <span class="eval-mini-label">Pond√©ration (%)</span>
                        <div class="spinner-group">
                            <div class="spinner-btn minus">-</div>
                            <input type="number" name="ev${i}_pond" class="spinner-input" value="0" step="5" style="width:100% !important;">
                            <div class="spinner-btn plus">+</div>
                        </div>
                    </div>
                    <div style="margin-bottom:15px;">
                        <span class="eval-mini-label">Dur√©e (min)</span>
                        <div class="spinner-group">
                            <div class="spinner-btn minus">-</div>
                            <input type="number" name="ev${i}_dur" class="spinner-input" value="0" step="5" style="width:100% !important;">
                            <div class="spinner-btn plus">+</div>
                        </div>
                    </div>

                    <div class="eval-section-title">Consid√©rations</div>
                    <label class="checkbox-wrapper"><input type="checkbox" name="ev${i}_c1"> Aide apprentissage</label>
                    <label class="checkbox-wrapper"><input type="checkbox" name="ev${i}_c2"> Temps supp.</label>
                    <label class="checkbox-wrapper"><input type="checkbox" name="ev${i}_c3"> Version adapt√©e</label>
                    <label class="checkbox-wrapper"><input type="checkbox" name="ev${i}_c4"> Inclusif</label>

                    <div class="eval-section-title">Int√©grit√© & S√©curit√©</div>
                    <label class="checkbox-wrapper" style="margin-bottom:4px;"><input type="checkbox" name="ev${i}_i1"> Questionnement complexe (Anti-IA)</label>
                    <label class="checkbox-wrapper" style="margin-bottom:4px;"><input type="checkbox" name="ev${i}_i2"> Consignes claires sur l'usage de l'IA</label>
                    <label class="checkbox-wrapper" style="margin-bottom:4px;"><input type="checkbox" name="ev${i}_i3"> Surveillance active (Cam√©ra/√âcran)</label>
                    <label class="checkbox-wrapper" style="margin-bottom:4px;"><input type="checkbox" name="ev${i}_i4"> Protocole de citation des sources</label>
                    <label class="checkbox-wrapper" style="margin-bottom:4px;"><input type="checkbox" name="ev${i}_i5"> Validation de l'identit√©</label>
                    
                    <div class="eval-section-title">Strat√©gies Anti-Plagiat</div>
                    <div style="font-size:9px; color:#666; margin-bottom:4px; line-height:1.3; font-style:italic;">
                        Suggestions : Temps minut√© strict ‚Ä¢ Cam√©ra ouverte ‚Ä¢ Partage √©cran/Word avec historique des versions ‚Ä¢ Banque de questions m√©lang√©es ‚Ä¢ Surveillance par cam√©ra t√©l√©phone
                    </div>
                    <textarea name="ev${i}_plag" style="width:100%; height:60px;" placeholder="D√©tails des mesures..."></textarea>
                </div>
            </div>
        </div>`;
    }

    function addEvaluationRow() {
        let d = document.createElement('div');
        d.innerHTML = createEvalHTML(evalContainer.children.length + 1);
        evalContainer.appendChild(d);
        updateAllCompetencySelects();
    }
    addEvaluationRow();

    // 7. SAVE/LOAD
    function saveData() {
        const formData = new FormData(document.getElementById('planningForm'));
        let obj = {};
        formData.forEach((v,k) => {
            if(!obj[k]) obj[k] = v;
            else { if(!Array.isArray(obj[k])) obj[k]=[obj[k]]; obj[k].push(v); }
        });
        document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(el => {
            if(el.checked) obj[el.name + (el.type==='radio'?'_val':'')] = el.value || "on";
        });
        obj._struct = { weeks: {}, evals: evalContainer.children.length };
        for(let i=1; i<=15; i++) obj._struct.weeks[i] = document.getElementById(`wc-${i}`).children.length;
        
        unsavedChanges = false; // R√©initialiser le drapeau de modification
        
        saveAs(new Blob([JSON.stringify(obj)], {type:'application/json'}), "Planification_Pharmacie.json");
    }

    function loadData(inp) {
        let f = inp.files[0]; if(!f) return;
        let r = new FileReader();
        r.onload = e => {
            let data = JSON.parse(e.target.result);
            if(data._struct) {
                for(let i=1; i<=15; i++) {
                    let diff = data._struct.weeks[i] - 1;
                    for(let k=0; k<diff; k++) addSessionRow(i);
                }
                while(evalContainer.children.length < data._struct.evals) addEvaluationRow();
            }
            if(data.courseSelect) {
                document.getElementById('courseSelect').value = data.courseSelect;
                updateCourseInfo();
            }
            setTimeout(() => {
                for(let k in data) {
                    if(k==='_struct') continue;
                    let el = document.getElementsByName(k)[0];
                    if(el) {
                        if(el.type !== 'checkbox' && el.type !== 'radio') el.value = data[k];
                    } else {
                        let chk = document.querySelector(`input[name="${k.replace('_val','')}"][value="${data[k]}"]`);
                        if(chk) chk.checked = true;
                        let chk2 = document.querySelector(`input[name="${k}"]`);
                        if(chk2) chk2.checked = true;
                    }
                }
                unsavedChanges = false; // R√©initialiser apr√®s chargement
            }, 100);
        };
        r.readAsText(f);
    }

    // 8. EXPORT WORD RIGOUREUX (The "Mirror" Method)
    function exportToWordDocx() {
        // Clone le DOM
        let clone = document.querySelector('.container').cloneNode(true);
        
        // Nettoyage UI (Boutons, Spinners, Aide) - SAUF Consignes
        clone.querySelectorAll('.control-bar, .btn-add, .btn-help-fad, .spinner-btn').forEach(e => e.remove());

        // 1. MIRROR SELECTS (Copie la valeur s√©lectionn√©e √† l'√©cran vers le clone)
        let origSelects = document.querySelectorAll('select');
        let cloneSelects = clone.querySelectorAll('select');
        for(let i=0; i<origSelects.length; i++) {
            let sOrig = origSelects[i];
            let sClone = cloneSelects[i];
            let val = sOrig.options[sOrig.selectedIndex] ? sOrig.options[sOrig.selectedIndex].text : "";
            if(val.startsWith("--") || val.startsWith("- ")) val = "";
            let d = document.createElement('div'); 
            d.innerHTML = "<b>" + val + "</b>";
            sClone.parentNode.replaceChild(d, sClone);
        }

        // 2. MIRROR INPUTS & TEXTAREAS
        let origInputs = document.querySelectorAll('textarea, input[type="text"], input[type="number"], input[type="date"]');
        let cloneInputs = clone.querySelectorAll('textarea, input[type="text"], input[type="number"], input[type="date"]');
        for(let i=0; i<origInputs.length; i++) {
            let iOrig = origInputs[i];
            let iClone = cloneInputs[i];
            let val = iOrig.value;
            
            // Suffixes automatiques
            if(iOrig.name.endsWith('_dur') || iOrig.name.endsWith('_dur')) val += " min";
            if(iOrig.name.endsWith('_pond')) val += " %";
            if(iOrig.type === 'date' && val) val = "üìÖ " + val;

            let d = document.createElement('div'); 
            d.innerHTML = val.replace(/\n/g, '<br>');
            
            // Styles titres
            if(iOrig.classList.contains('week-global-input')) { d.style.color='white'; d.style.fontWeight='bold'; d.style.fontSize='16px'; }
            if(iOrig.classList.contains('eval-title-input')) { d.style.color='white'; d.style.fontWeight='bold'; d.style.fontSize='14px'; }
            
            iClone.parentNode.replaceChild(d, iClone);
        }

        // 3. MIRROR CHECKBOXES/RADIOS (Logic specifically for Mode Selector & Checkboxes)
        let origChecks = document.querySelectorAll('.checkbox-wrapper, .mode-selector');
        let cloneChecks = clone.querySelectorAll('.checkbox-wrapper, .mode-selector');
        
        for(let i=0; i<origChecks.length; i++) {
            let wOrig = origChecks[i];
            let wClone = cloneChecks[i];

            // 3.1 GESTION SP√âCIFIQUE MODE SELECTOR (Synchrone/Asynchrone)
            if(wOrig.classList.contains('mode-selector')) {
                const checkedRadio = wOrig.querySelector('input:checked');
                if (checkedRadio) {
                    const isSync = checkedRadio.value === 'sync';
                    const color = isSync ? '#839AD1' : '#F0AF35'; // Blue / Mustard
                    const text = isSync ? 'SYNCHRONE' : 'ASYNCHRONE';
                    
                    // Create visual label for Word
                    wClone.innerHTML = `<div style="font-weight:bold; color:${color}; border:1px solid ${color}; padding:2px; text-align:center; margin-bottom:5px;">[MODE : ${text}]</div>`;
                } else {
                    wClone.remove(); // Remove if nothing selected
                }
            } 
            // 3.2 GESTION CHECKBOXES CLASSIQUES
            else {
                let inp = wOrig.querySelector('input');
                if(inp && inp.checked) {
                    let txt = wOrig.innerText.trim();
                    // Retirer le texte "(Anti-IA)" etc pour le word si trop long, ou garder tel quel
                    wClone.innerHTML = "‚òë " + txt;
                } else {
                    wClone.remove();
                }
            }
        }

        // 4. CONVERSION GRILLES -> TABLEAUX
        
        // Semaines
        clone.querySelectorAll('.grid-columns').forEach(g => {
            let t = document.createElement('table'); t.className = "word-table";
            let tr = t.insertRow();
            Array.from(g.children).forEach(c => {
                let td = tr.insertCell(); td.innerHTML = c.innerHTML;
                td.style.border="1px solid #999"; td.style.verticalAlign="top";
            });
            g.parentNode.replaceChild(t, g);
        });

        // Evaluations
        clone.querySelectorAll('.eval-block').forEach(blk => {
            let t = document.createElement('table'); t.className = "word-table";
            // Header
            let r1 = t.insertRow();
            let c1 = r1.insertCell(); c1.colSpan=3; 
            c1.innerHTML = blk.querySelector('.eval-header').innerHTML; 
            c1.style.background="#44474D"; c1.style.color="white";
            // Top Bar
            let r2 = t.insertRow();
            let c2 = r2.insertCell(); c2.colSpan=3;
            c2.innerHTML = blk.querySelector('.eval-top-bar').innerHTML;
            // Main Content
            let r3 = t.insertRow();
            let cDesc = r3.insertCell(); cDesc.colSpan=2; cDesc.style.width="70%";
            cDesc.innerHTML = blk.querySelector('.eval-desc-col').innerHTML;
            let cSide = r3.insertCell(); cSide.style.width="30%";
            cSide.innerHTML = blk.querySelector('.eval-side-col').innerHTML;

            [c1,c2,cDesc,cSide].forEach(td => { td.style.border="1px solid #999"; td.style.padding="5px"; td.style.verticalAlign="top"; });
            blk.innerHTML = "";
            blk.appendChild(t);
        });

        // Info Grid
        let ig = clone.querySelector('.info-grid');
        if(ig) {
            let t = document.createElement('table'); t.className = "word-table";
            let tr = t.insertRow();
            let c1 = tr.insertCell(); c1.style.width="40%"; c1.innerHTML = ig.querySelector('.info-col-left').innerHTML;
            let c2 = tr.insertCell(); c2.style.width="60%"; c2.innerHTML = ig.querySelector('.info-col-right').innerHTML;
            ig.parentNode.replaceChild(t, ig);
        }

        let css = `
            <style>
                body { font-family: Arial, sans-serif; font-size:11px; }
                .word-table { width:100%; border-collapse:collapse; margin-bottom:10px; }
                .word-table td { border:1px solid #999; padding:5px; }
                .week-global-header { background:#3D5E6B; color:white; padding:5px; font-weight:bold; }
                .col-header, .eval-section-title, label, .eval-mini-label { font-weight:bold; text-transform:uppercase; color:#444; }
                .session-badge { background:#9CA5B1; color:white; padding:2px 5px; }
                .eval-num { font-weight: bold; font-size: 14px; margin-right:10px; }
            </style>`;

        let html = `<!DOCTYPE html><html><head><meta charset="UTF-8">${css}</head><body>${clone.innerHTML}</body></html>`;
        saveAs(htmlDocx.asBlob(html, {orientation:'landscape', margins:{top:720, bottom:720, left:720, right:720}}), "Planification_Pharmacie_Finale.docx");
    }
</script>

</body>
</html>